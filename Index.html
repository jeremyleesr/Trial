<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Staff Scroll Visual Test</title>

<style>
  html, body {
    margin: 0;
    padding: 0;
    background: #062216;
    overflow: hidden;
    touch-action: none;
  }

  canvas {
    display: block;
  }

  #ui {
    position: absolute;
    top: 12px;
    left: 12px;
    color: #c8ffd8;
    font-family: system-ui, -apple-system, sans-serif;
    font-size: 14px;
  }

  button {
    padding: 10px 16px;
    border-radius: 10px;
    border: none;
    background: #32d27a;
    font-size: 16px;
    font-weight: 600;
  }
</style>
</head>

<body>
<div id="ui">
  <button>Start</button><br><br>
  Visual staff test (no audio)
</div>

<canvas id="c"></canvas>

<script>
const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");

function resize() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
window.addEventListener("resize", resize);
resize();

/* -------------------------
   Layout constants
-------------------------- */
const STAFF_RATIO = 0.22; // bottom 22%
let staffTop, staffHeight;
let trebleCenter, bassCenter, spacing;

/* -------------------------
   Notes (proper music)
-------------------------- */
const NOTE_MAP = {
  "C4": { staff: "treble", step: 0 },
  "D4": { staff: "treble", step: -1 },
  "E4": { staff: "treble", step: -2 },
  "F4": { staff: "treble", step: -3 },
  "G4": { staff: "treble", step: -4 },
  "A4": { staff: "treble", step: -5 },
  "B4": { staff: "treble", step: -6 },
  "C5": { staff: "treble", step: -7 },

  "B3": { staff: "bass", step: 1 },
  "A3": { staff: "bass", step: 2 },
  "G3": { staff: "bass", step: 3 },
  "F3": { staff: "bass", step: 4 },
  "E3": { staff: "bass", step: 5 },
  "D3": { staff: "bass", step: 6 },
  "C3": { staff: "bass", step: 7 }
};

/* -------------------------
   Test notes scrolling
-------------------------- */
const notes = [
  { note: "C4", x: 0 },
  { note: "E4", x: 200 },
  { note: "G4", x: 400 },
  { note: "C5", x: 600 },
  { note: "A3", x: 800 },
  { note: "F3", x: 1000 },
  { note: "C3", x: 1200 }
];

function setupNotes() {
  let start = canvas.width + 100;
  for (const n of notes) {
    n.x = start;
    start += 180;
  }
}
setupNotes();

/* -------------------------
   Drawing helpers
-------------------------- */
function drawStaff(centerY) {
  ctx.strokeStyle = "#e0fff0";
  ctx.lineWidth = 1.2;
  for (let i = -2; i <= 2; i++) {
    ctx.beginPath();
    ctx.moveTo(0, centerY + i * spacing);
    ctx.lineTo(canvas.width, centerY + i * spacing);
    ctx.stroke();
  }
}

function getNoteY(note) {
  const n = NOTE_MAP[note];
  const base = n.staff === "treble" ? trebleCenter : bassCenter;
  return base + n.step * (spacing / 2);
}

function drawLedgerLines(x, y, centerY) {
  const steps = Math.round((y - centerY) / (spacing / 2));
  const count = Math.abs(steps) - 5;
  if (count <= 0) return;

  for (let i = 0; i < count; i++) {
    const yy = centerY + Math.sign(steps) * (5 + i) * (spacing / 2);
    ctx.beginPath();
    ctx.moveTo(x - 14, yy);
    ctx.lineTo(x + 14, yy);
    ctx.stroke();
  }
}

function drawNote(x, y, centerY) {
  ctx.strokeStyle = "#ffffff";
  ctx.fillStyle = "#ffffff";

  drawLedgerLines(x, y, centerY);

  ctx.beginPath();
  ctx.ellipse(x, y, 10, 7, 0, 0, Math.PI * 2);
  ctx.fill();
}

/* -------------------------
   Main loop
-------------------------- */
function loop() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  staffHeight = canvas.height * STAFF_RATIO;
  staffTop = canvas.height - staffHeight;
  spacing = staffHeight / 10;

  trebleCenter = staffTop + spacing * 3;
  bassCenter = staffTop + spacing * 7;

  /* Green hit zone */
  const hitX = canvas.width * 0.5;
  const hitW = canvas.width * 0.12;
  ctx.fillStyle = "rgba(0, 255, 120, 0.25)";
  ctx.fillRect(hitX - hitW / 2, staffTop, hitW, staffHeight);

  /* Staves */
  drawStaff(trebleCenter);
  drawStaff(bassCenter);

  /* Notes */
  for (const n of notes) {
    n.x -= 2;

    const info = NOTE_MAP[n.note];
    const center = info.staff === "treble" ? trebleCenter : bassCenter;
    const y = getNoteY(n.note);

    drawNote(n.x, y, center);

    if (n.x < -50) {
      n.x = canvas.width + Math.random() * 300;
    }
  }

  requestAnimationFrame(loop);
}

loop();
</script>
</body>
</html>
