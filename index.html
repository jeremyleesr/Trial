<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Piano Hero – Visual Build v1.2</title>

<style>
  body {
    margin: 0;
    background: #1a1a1a;
    color: white;
    font-family: Arial, sans-serif;
    overflow: hidden;
  }

  #ui {
    position: absolute;
    top: 10px;
    left: 10px;
    z-index: 10;
  }

  button {
    font-size: 20px;
    padding: 10px 20px;
    border-radius: 8px;
    border: none;
    background: #4caf50;
    color: white;
    font-weight: bold;
  }

  canvas {
    display: block;
  }
</style>
</head>

<body>
<div id="ui">
  <button id="startBtn">START</button>
</div>

<canvas id="game"></canvas>

<script>
/* =========================
   CANVAS SETUP
========================= */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

function resize() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
window.addEventListener("resize", resize);
resize();

/* =========================
   STAFF LAYOUT (v1.2)
========================= */
const STAFF_LINE_GAP = 14;     // tight spacing
const STAFF_HEIGHT = STAFF_LINE_GAP * 4;
const STAFF_GAP = 40;          // gap between treble & bass

const STAFF_AREA_HEIGHT = STAFF_HEIGHT * 2 + STAFF_GAP;
const STAFF_TOP = canvas.height * 0.75 - STAFF_AREA_HEIGHT / 2;

/* =========================
   NOTE DATA (TEST)
========================= */
const notes = [
  { pitch: "E4", staff: "treble", time: 0 },
  { pitch: "G4", staff: "treble", time: 1 },
  { pitch: "C5", staff: "treble", time: 2 },

  { pitch: "C3", staff: "bass", time: 3 },
  { pitch: "E3", staff: "bass", time: 4 },
  { pitch: "G3", staff: "bass", time: 5 },
];

const NOTE_SPEED = 120; // px/sec
const HIT_X = canvas.width * 0.25;

/* =========================
   NOTE → Y POSITION MAP
========================= */
const NOTE_POS = {
  treble: {
    "E4": 4, "F4": 3.5, "G4": 3, "A4": 2.5, "B4": 2,
    "C5": 1.5, "D5": 1, "E5": 0.5
  },
  bass: {
    "C3": 4, "D3": 3.5, "E3": 3, "F3": 2.5, "G3": 2,
    "A3": 1.5, "B3": 1, "C4": 0.5
  }
};

/* =========================
   GAME STATE
========================= */
let startTime = null;
let running = false;

/* =========================
   DRAW STAFF
========================= */
function drawStaff(yTop) {
  ctx.strokeStyle = "black";
  ctx.lineWidth = 2;
  for (let i = 0; i < 5; i++) {
    ctx.beginPath();
    ctx.moveTo(0, yTop + i * STAFF_LINE_GAP);
    ctx.lineTo(canvas.width, yTop + i * STAFF_LINE_GAP);
    ctx.stroke();
  }
}

/* =========================
   DRAW NOTE
========================= */
function drawNote(x, y) {
  // head
  ctx.fillStyle = "black";
  ctx.beginPath();
  ctx.ellipse(x, y, 8, 6, -0.4, 0, Math.PI * 2);
  ctx.fill();

  // stem
  ctx.lineWidth = 2;
  ctx.beginPath();
  ctx.moveTo(x + 7, y);
  ctx.lineTo(x + 7, y - 28);
  ctx.stroke();
}

/* =========================
   MAIN LOOP
========================= */
function loop(timestamp) {
  if (!running) return;
  if (!startTime) startTime = timestamp;

  const elapsed = (timestamp - startTime) / 1000;

  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // white staff background
  ctx.fillStyle = "#fff";
  ctx.fillRect(0, STAFF_TOP - 20, canvas.width, STAFF_AREA_HEIGHT + 40);

  // treble staff
  drawStaff(STAFF_TOP);

  // bass staff
  drawStaff(STAFF_TOP + STAFF_HEIGHT + STAFF_GAP);

  // hit line
  ctx.strokeStyle = "green";
  ctx.lineWidth = 3;
  ctx.beginPath();
  ctx.moveTo(HIT_X, STAFF_TOP - 20);
  ctx.lineTo(HIT_X, STAFF_TOP + STAFF_AREA_HEIGHT + 20);
  ctx.stroke();

  // notes
  for (const note of notes) {
    const x = canvas.width - (elapsed - note.time) * NOTE_SPEED;
    if (x < -50) continue;

    const staffY =
      note.staff === "treble"
        ? STAFF_TOP
        : STAFF_TOP + STAFF_HEIGHT + STAFF_GAP;

    const posIndex = NOTE_POS[note.staff][note.pitch];
    if (posIndex === undefined) continue;

    const y = staffY + posIndex * STAFF_LINE_GAP;
    drawNote(x, y);
  }

  requestAnimationFrame(loop);
}

/* =========================
   START BUTTON
========================= */
document.getElementById("startBtn").onclick = () => {
  running = true;
  startTime = null;
  requestAnimationFrame(loop);
};
</script>
</body>
</html>
