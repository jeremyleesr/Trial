<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Grand Staff Scroll Test</title>

<style>
  html, body {
    margin: 0;
    padding: 0;
    background: #062216;
    overflow: hidden;
  }

  canvas {
    display: block;
  }

  #ui {
    position: absolute;
    top: 12px;
    left: 12px;
    color: #c8ffd8;
    font-family: system-ui, -apple-system, sans-serif;
    font-size: 14px;
  }

  button {
    padding: 10px 16px;
    border-radius: 10px;
    border: none;
    background: #32d27a;
    font-size: 16px;
    font-weight: 600;
  }
</style>
</head>

<body>
<div id="ui">
  <button>Start</button><br><br>
  Visual grand staff test (no audio)
</div>

<canvas id="c"></canvas>

<script>
const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");

function resize() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
window.addEventListener("resize", resize);
resize();

/* -------------------------
   Layout
-------------------------- */
const STAFF_AREA_RATIO = 0.26;   // bottom 26%
const STAFF_GAP_RATIO  = 0.22;   // space between staves

let staffTop, staffHeight;
let trebleCenter, bassCenter;
let lineSpacing;

/* -------------------------
   Note definitions
-------------------------- */
const NOTE_MAP = {
  "C5": { staff: "treble", step: -6 },
  "A4": { staff: "treble", step: -5 },
  "F4": { staff: "treble", step: -4 },
  "E4": { staff: "treble", step: -3 },
  "D4": { staff: "treble", step: -2 },
  "C4": { staff: "treble", step: -1 },

  "B3": { staff: "bass", step: 1 },
  "A3": { staff: "bass", step: 2 },
  "G3": { staff: "bass", step: 3 },
  "F3": { staff: "bass", step: 4 },
  "E3": { staff: "bass", step: 5 },
  "C3": { staff: "bass", step: 6 }
};

/* -------------------------
   Test notes
-------------------------- */
const notes = [
  { note: "C5", x: 0 },
  { note: "A4", x: 180 },
  { note: "F4", x: 360 },
  { note: "C4", x: 540 },
  { note: "B3", x: 720 },
  { note: "G3", x: 900 },
  { note: "C3", x: 1080 }
];

function resetNotes() {
  let start = canvas.width + 100;
  for (const n of notes) {
    n.x = start;
    start += 200;
  }
}
resetNotes();

/* -------------------------
   Drawing helpers
-------------------------- */
function drawStaff(centerY) {
  ctx.strokeStyle = "#e6fff3";
  ctx.lineWidth = 1.2;

  for (let i = -2; i <= 2; i++) {
    ctx.beginPath();
    ctx.moveTo(0, centerY + i * lineSpacing);
    ctx.lineTo(canvas.width, centerY + i * lineSpacing);
    ctx.stroke();
  }
}

function noteY(note) {
  const n = NOTE_MAP[note];
  const base = n.staff === "treble" ? trebleCenter : bassCenter;
  return base + n.step * (lineSpacing / 2);
}

function drawLedgerLines(x, y, centerY) {
  const offset = (y - centerY) / (lineSpacing / 2);
  const steps = Math.round(offset);

  if (Math.abs(steps) <= 4) return;

  const count = Math.abs(steps) - 4;
  for (let i = 0; i < count; i++) {
    const yy = centerY + Math.sign(steps) * (4 + i) * (lineSpacing / 2);
    ctx.beginPath();
    ctx.moveTo(x - 14, yy);
    ctx.lineTo(x + 14, yy);
    ctx.stroke();
  }
}

function drawNote(x, y, centerY) {
  ctx.strokeStyle = "#ffffff";
  ctx.fillStyle = "#ffffff";

  drawLedgerLines(x, y, centerY);

  ctx.beginPath();
  ctx.ellipse(x, y, 10, 7, 0, 0, Math.PI * 2);
  ctx.fill();
}

/* -------------------------
   Main loop
-------------------------- */
function loop() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  staffHeight = canvas.height * STAFF_AREA_RATIO;
  staffTop = canvas.height - staffHeight;

  const staffGap = staffHeight * STAFF_GAP_RATIO;
  const singleStaffHeight = (staffHeight - staffGap) / 2;

  lineSpacing = singleStaffHeight / 4;

  trebleCenter = staffTop + singleStaffHeight / 2;
  bassCenter   = staffTop + singleStaffHeight + staffGap + singleStaffHeight / 2;

  /* Hit zone */
  const hitX = canvas.width * 0.5;
  const hitW = canvas.width * 0.12;
  ctx.fillStyle = "rgba(0,255,120,0.22)";
  ctx.fillRect(hitX - hitW / 2, staffTop, hitW, staffHeight);

  /* Draw staves */
  drawStaff(trebleCenter);
  drawStaff(bassCenter);

  /* Draw notes */
  for (const n of notes) {
    n.x -= 2.2;

    const info = NOTE_MAP[n.note];
    const center = info.staff === "treble" ? trebleCenter : bassCenter;
    const y = noteY(n.note);

    drawNote(n.x, y, center);

    if (n.x < -50) {
      n.x = canvas.width + Math.random() * 300;
    }
  }

  requestAnimationFrame(loop);
}

loop();
</script>
</body>
</html>
